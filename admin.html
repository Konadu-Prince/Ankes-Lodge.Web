    <script>
        // Function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        // Offline data storage
        let offlineData = {
            bookings: [],
            contacts: [],
            testimonials: []
        };
        
        // Flag to track if we're currently offline
        let isOffline = false;
        
        // Function to save data locally when offline
        function saveOfflineData(type, data) {
            offlineData[type] = data;
            localStorage.setItem(`offline_${type}`, JSON.stringify(data));
            console.log(`Saved ${type} data locally for sync when online`);
        }
        
        // Function to load offline data
        function loadOfflineData() {
            try {
                offlineData.bookings = JSON.parse(localStorage.getItem('offline_bookings') || '[]');
                offlineData.contacts = JSON.parse(localStorage.getItem('offline_contacts') || '[]');
                offlineData.testimonials = JSON.parse(localStorage.getItem('offline_testimonials') || '[]');
            } catch (error) {
                console.error('Error loading offline data:', error);
            }
        }
        
        // Function to sync offline data when connection is restored
        async function syncOfflineData() {
            if (isOffline) return;
            
            console.log('Attempting to sync offline data...');
            
            // Sync each type of data
            for (const type of ['bookings', 'contacts', 'testimonials']) {
                if (offlineData[type].length > 0) {
                    console.log(`Syncing ${offlineData[type].length} ${type} items...`);
                    
                    // For now, we'll just clear the offline data since the main data is already in the database
                    // In a more complex scenario, we might need to send this data to the server
                    offlineData[type] = [];
                    localStorage.removeItem(`offline_${type}`);
                }
            }
            
            // Refresh all data after sync
            loadBookings();
            loadContacts();
            loadTestimonials();
            
            console.log('Offline data sync completed');
        }
        
        // Function to fetch and display bookings
        function loadBookings() {
            fetch('/bookings.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(bookings => {
                    // If we were offline, now we're back online - sync data
                    if (isOffline) {
                        isOffline = false;
                        syncOfflineData();
                    }
                    
                    const tbody = document.getElementById('bookingsBody');
                    
                    if (bookings.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" class="no-bookings">No bookings found</td></tr>';
                        return;
                    }
                    
                    // Clear existing content
                    tbody.innerHTML = '';
                    
                    // Add bookings to table (reverse order to show newest first)
                    bookings.slice().reverse().forEach(booking => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${booking.id?.substring(0, 8) || 'N/A'}</td>
                            <td>${formatDate(booking.timestamp)}</td>
                            <td>${booking.name || 'N/A'}</td>
                            <td>${booking.email || 'N/A'}</td>
                            <td>${booking.phone || 'N/A'}</td>
                            <td>${booking.checkin || 'N/A'}</td>
                            <td>${booking.checkout || 'N/A'}</td>
                            <td>${booking.adults || 0} adults, ${booking.children || 0} children</td>
                            <td>${booking['room-type'] || booking.roomType || 'N/A'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading bookings:', error);
                    isOffline = true;
                    
                    // Try to load from localStorage as fallback
                    try {
                        const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                        saveOfflineData('bookings', bookings);
                        
                        const tbody = document.getElementById('bookingsBody');
                        if (bookings.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="9" class="no-bookings">No bookings found (offline mode)</td></tr>';
                            return;
                        }
                        
                        // Clear existing content
                        tbody.innerHTML = '';
                        
                        // Add bookings to table (reverse order to show newest first)
                        bookings.slice().reverse().forEach(booking => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${booking.id?.substring(0, 8) || 'N/A'}</td>
                                <td>${formatDate(booking.timestamp)}</td>
                                <td>${booking.name || 'N/A'}</td>
                                <td>${booking.email || 'N/A'}</td>
                                <td>${booking.phone || 'N/A'}</td>
                                <td>${booking.checkin || 'N/A'}</td>
                                <td>${booking.checkout || 'N/A'}</td>
                                <td>${booking.adults || 0} adults, ${booking.children || 0} children</td>
                                <td>${booking['room-type'] || booking.roomType || 'N/A'}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    } catch (storageError) {
                        document.getElementById('bookingsBody').innerHTML = '<tr><td colspan="9" class="no-bookings">Error loading bookings (offline mode unavailable)</td></tr>';
                    }
                });
        }
        
        // Function to fetch and display contacts
        function loadContacts() {
            fetch('/contacts.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(contacts => {
                    // If we were offline, now we're back online - sync data
                    if (isOffline) {
                        isOffline = false;
                        syncOfflineData();
                    }
                    
                    const tbody = document.getElementById('contactsBody');
                    
                    if (contacts.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="no-bookings">No contacts found</td></tr>';
                        return;
                    }
                    
                    // Clear existing content
                    tbody.innerHTML = '';
                    
                    // Add contacts to table (reverse order to show newest first)
                    contacts.slice().reverse().forEach(contact => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${contact.id?.substring(0, 8) || 'N/A'}</td>
                            <td>${formatDate(contact.timestamp)}</td>
                            <td>${contact['contact-name'] || contact.name || 'N/A'}</td>
                            <td>${contact['contact-email'] || contact.email || 'N/A'}</td>
                            <td>${contact.subject || 'N/A'}</td>
                            <td>${contact['contact-message'] || contact.message || 'N/A'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading contacts:', error);
                    isOffline = true;
                    
                    // Try to load from localStorage as fallback
                    try {
                        const contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
                        saveOfflineData('contacts', contacts);
                        
                        const tbody = document.getElementById('contactsBody');
                        if (contacts.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="6" class="no-bookings">No contacts found (offline mode)</td></tr>';
                            return;
                        }
                        
                        // Clear existing content
                        tbody.innerHTML = '';
                        
                        // Add contacts to table (reverse order to show newest first)
                        contacts.slice().reverse().forEach(contact => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${contact.id?.substring(0, 8) || 'N/A'}</td>
                                <td>${formatDate(contact.timestamp)}</td>
                                <td>${contact['contact-name'] || contact.name || 'N/A'}</td>
                                <td>${contact['contact-email'] || contact.email || 'N/A'}</td>
                                <td>${contact.subject || 'N/A'}</td>
                                <td>${contact['contact-message'] || contact.message || 'N/A'}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    } catch (storageError) {
                        document.getElementById('contactsBody').innerHTML = '<tr><td colspan="6" class="no-bookings">Error loading contacts (offline mode unavailable)</td></tr>';
                    }
                });
        }
        
        // Function to fetch and display testimonials
        function loadTestimonials() {
            fetch('/testimonials.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(testimonials => {
                    // If we were offline, now we're back online - sync data
                    if (isOffline) {
                        isOffline = false;
                        syncOfflineData();
                    }
                    
                    const tbody = document.getElementById('testimonialsBody');
                    
                    if (testimonials.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" class="no-bookings">No testimonials found</td></tr>';
                        return;
                    }
                    
                    // Clear existing content
                    tbody.innerHTML = '';
                    
                    // Add testimonials to table (reverse order to show newest first)
                    testimonials.forEach(testimonial => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${testimonial.id}</td>
                            <td>${formatDate(testimonial.date)}</td>
                            <td>${testimonial.name || 'N/A'}</td>
                            <td>${testimonial.location || 'N/A'}</td>
                            <td>${'★'.repeat(testimonial.rating) + '☆'.repeat(5 - testimonial.rating)} (${testimonial.rating})</td>
                            <td style="max-width: 300px; word-wrap: break-word;">${testimonial.comment || 'N/A'}</td>
                            <td>
                                <button class="delete-btn" data-id="${testimonial.id}" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    // Add event listeners to delete buttons
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            deleteTestimonial(id);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading testimonials:', error);
                    isOffline = true;
                    
                    // Try to load from localStorage as fallback
                    try {
                        const testimonials = JSON.parse(localStorage.getItem('testimonials') || '[]');
                        saveOfflineData('testimonials', testimonials);
                        
                        const tbody = document.getElementById('testimonialsBody');
                        if (testimonials.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="7" class="no-bookings">No testimonials found (offline mode)</td></tr>';
                            return;
                        }
                        
                        // Clear existing content
                        tbody.innerHTML = '';
                        
                        // Add testimonials to table (reverse order to show newest first)
                        testimonials.forEach(testimonial => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${testimonial.id}</td>
                                <td>${formatDate(testimonial.date)}</td>
                                <td>${testimonial.name || 'N/A'}</td>
                                <td>${testimonial.location || 'N/A'}</td>
                                <td>${'★'.repeat(testimonial.rating) + '☆'.repeat(5 - testimonial.rating)} (${testimonial.rating})</td>
                                <td style="max-width: 300px; word-wrap: break-word;">${testimonial.comment || 'N/A'}</td>
                                <td>
                                    <button class="delete-btn" data-id="${testimonial.id}" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        // Add event listeners to delete buttons
                        document.querySelectorAll('.delete-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const id = parseInt(this.getAttribute('data-id'));
                                deleteTestimonial(id);
                            });
                        });
                    } catch (storageError) {
                        document.getElementById('testimonialsBody').innerHTML = '<tr><td colspan="7" class="no-bookings">Error loading testimonials (offline mode unavailable)</td></tr>';
                    }
                });
        }
        
        // Function to delete a testimonial
        function deleteTestimonial(id) {
            if (!confirm('Are you sure you want to delete this testimonial?')) {
                return;
            }
            
            fetch(`/delete-testimonial/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Testimonial deleted successfully!');
                    loadTestimonials(); // Refresh the list
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error deleting testimonial:', error);
                alert('Failed to delete testimonial. Please try again later.');
            });
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadOfflineData();
            loadBookings();
            loadContacts();
            loadTestimonials();
        });
        
        // Refresh button events
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadBookings();
            loadContacts();
        });
        
        document.getElementById('refreshTestimonialsBtn').addEventListener('click', function() {
            loadTestimonials();
        });
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding content
                const tabName = this.getAttribute('data-tab');
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });
        
        // Logout functionality
        document.getElementById('logoutLink').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Send logout request
            fetch('/admin/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Redirect to login page
                    window.location.href = '/login.html';
                } else {
                    alert('Error logging out. Please try again.');
                }
            })
            .catch(error => {
                console.error('Logout error:', error);
                alert('Error logging out. Please try again.');
            });
        });
    </script>
</body>
</html>